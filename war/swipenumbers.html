<!DOCTYPE HTML>
<!-- Copyright 2014 Brian Spiegel -->
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<title>Swipe Numbers!</title>
<style type="text/css">
.ball {
  background-color:#0000ff;
  width: 50px;
  height: 50px;
  border-radius: 25px; 
}
</style>
</head>
<body>
<script>

/*
TODO

col/rows...
Draw with div...

Swipe
Check if adding to number.
If so, remove numbers, add score. Shift down.

Start at 11. Need 11 11 times. Then 12 twelve times.
Color numbers.  Selection yellow?
*/

function Ball() {
  this.x=0;
  this.y=0;
  this.number=0;
  this.selected=false;
}

// Coordinates for touch movement
function Coordinates(x, y) {
  this.x=x;
  this.y=y;
}

// Constants
var BOARD_COL=2;
var BOARD_ROW=2;
var STARTING_BALL_MAX=10;
var BALL_RADIUS=20;

// Game variables
var isGameOver=false;
var isGameWon=false;
var points=0;
var board=new Array();

///////////////////
// Utilities
///////////////////

function createRandomExclusive(max) {
  return Math.floor(Math.random()*max);
}

function removeChildrenFromElement(element) {
  if (element.hasChildNodes()) {
    while (element.childNodes.length>0) {
      element.removeChild(element.firstChild);
    }
  }
}

///////////////////
// Board
///////////////////

function createBoard() {
  for (var i=0;i<BOARD_COL;i++) {
    var col=new Array();
    board.push(col);
    for (var j=0;j<BOARD_ROW;j++) {
      var ball=new Ball();
      ball.number=createRandomExclusive(STARTING_BALL_MAX)+1;
      col.push(ball);
    }
  }
}

function detectSelection(coor) {
  for (var i=0;i<board.length;i++) {
    // Cols?
  }  
}

///////////////////
// Draw
///////////////////

function clearBoard() {
  var boardDisplay=document.getElementById("board");
//  removeChildrenFromElement(boardDisplay);
}

function drawBall(ball) {
  var ballDisplay=document.createElement("div");
  ballDisplay.setAttribute("class", "ball");
  ballDisplay.appendChild(document.createTextNode(ball.number));
  return ballDisplay;
}

function drawBalls() {
  var boardDisplay=document.getElementById("board");
  for (var i=0;i<board.length;i++) {
  
        debug('2');
    var col=board[i];
    for (var j=0;j<col.length;j++) {
      boardDisplay.appendChild(drawBall(col[j]));
      
    }
  }
}

function drawBoard() {
    clearBoard();
    drawBalls();
}

function updatePointsDisplay() {
  document.getElementById("points").innerHTML=points;
}

function debug(text) {
  document.getElementById("debug").innerHTML=text;
}

///////////////////
// Interaction
///////////////////

// Get coordinates from a touch event
function getCoordinatesTouchEvent(ev) {
  var x;
  var y;
  if (ev.touches && ev.touches.length) { // Multi touch
    //debug('multi');
    x = ev.touches[0].clientX;
    y = ev.touches[0].clientY;
  } else { // Single touch
    //debug('single');
    x = e.clientX;
    y = e.clientY;
  }

  // debug(x + "," + y);
  
  return new Coordinates(x, y);
}

function touchMove(ev) {
  ev.preventDefault();
//  var coor=getCoordinatesTouchEvent(ev);
//  detectSelection(coor);
}

function touchStart(ev) {
//  var coor=getCoordinatesTouchEvent(ev);
//  detectSelection(coor);
}

function mouseMove (ev) {
  var x;
  var y;
  
  if (ev.offsetX || ev.offsetX == 0) {
    x = ev.offsetX;
  }
  if (ev.offsetY || ev.offsetY == 0) {
    y = ev.offsetY;
  }
  var coor=new Coordinates(x, y);
  
  //debug(x + "," + y);
  
  // Check if inside ball  
  //detectSelection(coor);
}
///////////////////
// Set-up
///////////////////

function init() {

  var board=document.getElementById("board");

  // Set listeners
  //board.addEventListener('mousemove', mouseMove, false);
  board.addEventListener('touchstart', touchStart, false);
  board.addEventListener('touchmove', touchMove, false);
  
  newGame();
}

function newGame() {

  // Reset variables
  isGameOver=false;
  isGameWon=false;
  points=0;
  balls=new Array();
  debug('');
  
  createBoard();

  // Update points
  updatePointsDisplay();  

  // Draw board and start animation
  drawBoard();
}


</script>
<div style="width:320px">
  <div style="float:left">Points: <span id="points">100</span></div>
  <br/>
  <div style="border:1px #000000 solid;" id="board" width="320" height="320">
    TEST
  </div>
  <div style="float:left;margin-top:1em;">
    <button onclick="newGame();return false;">New Game v1</button><br/><br/>
  </div>
  <div id="debug"></div>
</div>
<script>
init();
</script>
</body>
</html>